# SharpFort (原 YiFramework) 项目上下文

## 项目概述

**SharpFort** 是一个基于 .NET 8、ABP Framework v8.3 和 SqlSugar ORM 的 DDD (领域驱动设计) 后端开源框架。该项目由原 **YiFramework** Fork 而来，由新维护者长期维护和发展。

### 技术栈
- **.NET 8** - 运行时框架
- **ABP Framework v8.3** - 应用程序框架
- **SqlSugar** - Code First ORM
- **FreeRedis** - Redis 缓存
- **Hangfire** - 后台任务调度
- **Mapster** - 对象映射

### 项目愿景
1. **商业化目标** - 打造企业级可用的后端框架
2. **开源社区建设** - 建立活跃的开发者社区

---

## 项目架构

### 目录结构
```
Yi.Abp.Net8/
├── framework/                    # 框架层 (11个项目)
│   ├── Yi.Framework.Core/        # 核心工具类库
│   │   └── Helper/              # 自定义帮助类 (27个)
│   ├── Yi.Framework.AspNetCore/  # ASP.NET Core 集成
│   ├── Yi.Framework.Ddd.Application/
│   ├── Yi.Framework.Ddd.Application.Contracts/
│   ├── Yi.Framework.SqlSugarCore/
│   ├── Yi.Framework.SqlSugarCore.Abstractions/
│   ├── Yi.Framework.Mapster/
│   ├── Yi.Framework.Caching.FreeRedis/
│   ├── Yi.Framework.BackgroundWorkers.Hangfire/
│   ├── Yi.Framework.AspNetCore.Authentication.OAuth/
│   └── Yi.Framework.WeChat.MiniProgram/
├── module/                       # 功能模块层 (6个模块)
│   ├── rbac/                    # 基于角色的访问控制
│   ├── bbs/                     # 论坛系统
│   ├── audit-logging/           # 审计日志
│   ├── tenant-management/       # 租户管理
│   ├── setting-management/      # 设置管理
│   └── code-gen/                # 代码生成
├── src/                          # 应用层
│   ├── Yi.Abp.Web/              # Web 主项目
│   ├── Yi.Abp.Application/
│   ├── Yi.Abp.Application.Contracts/
│   ├── Yi.Abp.Domain/
│   ├── Yi.Abp.Domain.Shared/
│   └── Yi.Abp.SqlSugarCore/
└── test/                         # 测试项目
```

### DDD 分层架构
每个模块遵循标准的 DDD 分层：
- **Domain.Shared** - 共享的枚举、常量、DTO
- **Domain** - 领域实体、聚合根、领域服务
- **Application.Contracts** - 应用服务接口、DTO
- **Application** - 应用服务实现
- **SqlSugarCore** - 数据访问层

---

## 重构路线图

### 阶段 1: 代码质量与安全性 (优先级: 高)
1. **安全增强** - 将 SHA512 密码加密替换为 BCrypt
2. **命名规范** - 修正命名不一致问题
3. **依赖项清理** - 用 Masuit.Tools 替换自定义 Helper

### 阶段 2: 框架升级 (优先级: 中)
1. **ABP v8.3 → v9.0+** 升级计划
2. **移除废弃 API** 警告
3. **统一编码标准** (UTF-8)

### 阶段 3: 品牌重塑 (优先级: 低)
1. **命名空间迁移** - YiFramework → SharpFort
2. **程序集重命名**
3. **文档更新**

---

## 已识别的关键问题

### 安全问题 (Critical)
- **密码加密**: 使用 SHA512 而非 BCrypt，缺乏工作因子保护
- **位置**: `module/rbac/Yi.Framework.Rbac.Domain/Entities/UserAggregateRoot.cs:190-191`

### 代码规范问题
- **实体命名**: 冗余后缀 `AggregateRoot`/`Entity` (33+ 个实体)
- **枚举命名**: 冗余后缀 `Enum` (20+ 个枚举)
- **拼写错误**: `MD5Hepler.cs` (应为 Helper)
- **性别枚举**: `SexEnum` 应改为 `GenderEnum`，且 `Woman` 应改为 `Female`

### 技术债务
- **废弃 API**: `RNGCryptoServiceProvider`、`SHA512.Create()` 等
- **硬编码**: 文件编码使用 "gb2312" 而非 UTF-8
- **重复代码**: Helper 类与 Masuit.Tools 功能重叠

---

## 开发指南

### 创建新实体
```csharp
// 正确: 简洁命名
public class User : AggregateRoot<Guid>, IFullAuditedObject
{
    // 使用完整审计接口，而非单独实现 IAuditedObject
}

// 错误: 冗余后缀
public class UserAggregateRoot : AggregateRoot<Guid>
```

### 定义枚举
```csharp
// 正确: 无 Enum 后缀
public enum Gender
{
    Male = 0,
    Female = 1,  // 不是 Woman
    Unknown = 2
}

// 错误: 带 Enum 后缀
public enum SexEnum
```

### 密码处理
```csharp
// 推荐: BCrypt (待实现)
var hashedPassword = BCrypt.Net.BCrypt.HashPassword(password);
var isValid = BCrypt.Net.BCrypt.Verify(password, hashedPassword);

// 当前实现 (不安全):
var hash = MD5Helper.SHA2Encode(password, salt);
```

### 工具类使用
优先使用 `Masuit.Tools` 而非自定义 Helper:
- 字符串操作: `Masuit.Tools.Strings`
- 日期处理: `Masuit.Tools.DateTimeExt`
- 文件操作: `Masuit.Tools.Files`

---

## 参考文档

- [ABP Framework 官方文档](https://docs.abp.io/)
- [SqlSugar 官方文档](https://www.donet5.com/Home/Doc)
- [Masuit.Tools GitHub](https://github.com/ldqk/Masuit.Tools)
- [BCrypt.Net-Next NuGet](https://www.nuget.org/packages/BCrypt.Net-Next/)

---

## 联系与贡献

- **开源组织**: github.com/SharpFort
- **问题反馈**: 请通过 GitHub Issues
- **贡献代码**: 遵循本项目最佳实践指南
